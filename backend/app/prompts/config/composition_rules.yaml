# Prompt Composition Rules - Single-Use Compositions for LangGraph Orchestration
# Each composition maps to a single user prompt plus system prompts

compositions:
  # OCR Compositions
  ocr_whole_document_extraction:
    description: "Extract text from entire document with OCR"
    version: "1.0.0"
    system_prompts:
      - name: "ocr_processor"
        path: "system/ocr_processor.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 80
        required: true
    user_prompts:
      - "ocr_whole_document_extraction"

  ocr_text_diagram_insight:
    description: "Extract insights from text and diagram content"
    version: "1.0.0"
    system_prompts:
      - name: "ocr_processor"
        path: "system/ocr_processor.md"
        priority: 100
        required: true
      # - name: "legal_specialist"
      #   path: "system/realestate_lawyer.md"
      #   priority: 90
      #   required: true
    user_prompts:
      - "ocr_text_diagram_insight"

  layout_summarise_only:
    description: "Summarise layout and extract contract taxonomy/terms"
    version: "1.0.0"
    system_prompts:
      - name: "document_core"
        path: "system/document_core.md"
        priority: 100
        required: true
    user_prompts:
      - "layout_summarise"

  # Analysis Compositions
  structure_analysis_only:
    description: "Analyze contract structure from extracted text"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "contract_analysis_base"

  contract_term_extraction:
    description: "Basic combined structure analysis using contract term extraction prompt"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "contract_term_extraction"

  contract_entities_extraction:
    description: "Extract entities from contracts using the entities extraction prompt"
    version: "1.0.0"
    system_prompts:
      - name: "entity_extraction_core"
        path: "system/entity_extraction_core.md"
        priority: 110
        required: true
    user_prompts:
      - "contract_entities_extraction"

  section_seeds_extraction:
    description: "Extract section seeds using dedicated planner prompt"
    version: "1.0.0"
    system_prompts:
      - name: "entity_extraction_core"
        path: "system/entity_extraction_core.md"
        priority: 110
        required: true
    user_prompts:
      - "section_seeds_planner"

  # Step 2 Section Analysis Compositions
  step2_parties_property:
    description: "Step 2.1 - Parties and Property Verification Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_parties_property"

  step2_financial_terms:
    description: "Step 2.2 - Financial Terms Analysis and Verification"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_financial_terms"

  step2_conditions:
    description: "Step 2.4 - Conditions Risk Assessment Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_conditions"

  step2_warranties:
    description: "Step 2.5 - Warranties and Representations Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_warranties"

  step2_default_termination:
    description: "Step 2.6 - Default and Termination Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_default_termination"

  step2_diagram_semantics:
    description: "Step 2.3 - Diagram/Image Semantics Analysis (Generic)"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics"

  # Diagram-Specific Semantic Analysis Compositions
  step2_diagram_semantics_site_plan:
    description: "Step 2.3 - Site Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_site_plan"

  step2_diagram_semantics_sewer_service_diagram:
    description: "Step 2.3 - Sewer Service Diagram Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_sewer_service_diagram"

  step2_diagram_semantics_survey_diagram:
    description: "Step 2.3 - Survey Diagram Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_survey_diagram"

  step2_diagram_semantics_flood_map:
    description: "Step 2.3 - Flood Map Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_flood_map"

  step2_diagram_semantics_bushfire_map:
    description: "Step 2.3 - Bushfire Map Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_bushfire_map"

  step2_diagram_semantics_utility_plan:
    description: "Step 2.3 - Utility Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_utility_plan"

  step2_diagram_semantics_title_plan:
    description: "Step 2.3 - Title Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_title_plan"

  step2_diagram_semantics_zoning_map:
    description: "Step 2.3 - Zoning Map Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_zoning_map"

  step2_diagram_semantics_environmental_overlay:
    description: "Step 2.3 - Environmental Overlay Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_environmental_overlay"

  step2_diagram_semantics_contour_map:
    description: "Step 2.3 - Contour Map Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_contour_map"

  step2_diagram_semantics_drainage_plan:
    description: "Step 2.3 - Drainage Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_drainage_plan"

  step2_diagram_semantics_building_envelope_plan:
    description: "Step 2.3 - Building Envelope Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_building_envelope_plan"

  step2_diagram_semantics_development_plan:
    description: "Step 2.3 - Development Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_development_plan"

  step2_diagram_semantics_aerial_view:
    description: "Step 2.3 - Aerial View Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_aerial_view"

  step2_diagram_semantics_strata_plan:
    description: "Step 2.3 - Strata Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_strata_plan"

  step2_diagram_semantics_heritage_overlay:
    description: "Step 2.3 - Heritage Overlay Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_heritage_overlay"

  step2_diagram_semantics_subdivision_plan:
    description: "Step 2.3 - Subdivision Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_subdivision_plan"

  step2_diagram_semantics_landscape_plan:
    description: "Step 2.3 - Landscape Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_landscape_plan"

  step2_diagram_semantics_parking_plan:
    description: "Step 2.3 - Parking Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_parking_plan"

  step2_diagram_semantics_body_corporate_plan:
    description: "Step 2.3 - Body Corporate Plan Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_body_corporate_plan"

  step2_diagram_semantics_off_the_plan_marketing:
    description: "Step 2.3 - Off-the-Plan Marketing Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_off_the_plan_marketing"

  step2_diagram_semantics_cross_section:
    description: "Step 2.3 - Cross Section Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_cross_section"

  step2_diagram_semantics_elevation_view:
    description: "Step 2.3 - Elevation View Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_elevation_view"

  step2_diagram_semantics_unknown:
    description: "Step 2.3 - Unknown Diagram Semantic Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_image_semantics"
        path: "system/step2_image_semantics.md"
        priority: 105
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "image_semantics_unknown"

  step2_diagram_risk:
    description: "Step 2.3b - Diagram/Image Risk Assessment from image semantics"
    version: "2.0.0"
    system_prompts:
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_diagram_risk"
    fragment_groups:
      - "diagram_analysis"
      - "state_requirements"
      - "user_experience"
      - "analysis_depth"
      - "shared"

  # Step 3 Synthesis Compositions
  step3_risk_aggregation:
    description: "Step 3 - Risk Aggregation and Prioritization"
    version: "1.0.0"
    system_prompts:
      - name: "step3_synthesis_system"
        path: "system/step3_synthesis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step3_risk_aggregation"

  step3_action_plan:
    description: "Step 3 - Recommended Actions & Timeline"
    version: "1.0.0"
    system_prompts:
      - name: "step3_synthesis_system"
        path: "system/step3_synthesis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step3_action_plan"

  step3_compliance_score:
    description: "Step 3 - Compliance Readiness Score"
    version: "1.0.0"
    system_prompts:
      - name: "step3_synthesis_system"
        path: "system/step3_synthesis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step3_compliance_score"

  step3_buyer_report:
    description: "Step 3 - Buyer Report Synthesis"
    version: "1.0.0"
    system_prompts:
      - name: "step3_synthesis_system"
        path: "system/step3_synthesis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step3_buyer_report"

  step2_settlement:
    description: "Step 2.7 - Settlement Logistics Analysis"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_settlement"

  step2_title_encumbrances:
    description: "Step 2.8 - Title and Encumbrances Analysis with Diagram Integration"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_title_encumbrances"

  step2_adjustments:
    description: "Step 2.9 - Adjustments and Outgoings Calculator"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_adjustments"

  step2_disclosure:
    description: "Step 2.10 - Disclosure Compliance Check"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_disclosure"

  step2_special_risks:
    description: "Step 2.11 - Special Risks Identification"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_special_risks"

  step2_cross_validation:
    description: "Step 2.12 - Cross-Section Validation and Consistency Checks"
    version: "1.0.0"
    system_prompts:
      - name: "step2_section_analysis"
        path: "system/step2_section_analysis.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "step2_cross_validation"

  compliance_check_only:
    description: "Check legal compliance requirements"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "contract_analysis_base"

  financial_analysis_only:
    description: "Analyze financial terms and obligations"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "financial_analysis"

  risk_assessment_only:
    description: "Assess contract risks and potential issues"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "risk_assessment_base"

  recommendations_only:
    description: "Generate contract recommendations"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "contract_recommendations"

  # Semantic Analysis Compositions
  semantic_analysis_only:
    description: "Extract semantic meaning from diagrams"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "ocr_text_diagram_insight"

  image_semantics_only:
    description: "Analyze image semantics and content"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "ocr_text_diagram_insight"

  # Validation Compositions
  document_quality_validation_only:
    description: "Validate document quality and completeness"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
    user_prompts:
      - "validation_document_quality"

  terms_validation_only:
    description: "Validate contract terms completeness"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
      - name: "australian_legal"
        path: "system/conveyancer.md"
        priority: 90
        required: true
    user_prompts:
      - "validation_terms_completeness"

  final_validation_only:
    description: "Perform final output validation"
    version: "1.0.0"
    system_prompts:
      - name: "legal_specialist"
        path: "system/realestate_lawyer.md"
        priority: 100
        required: true
    user_prompts:
      - "validation_final_output"

# Global composition settings (simplified)
global_settings:
  cache_ttl_seconds: 1800  # 30 minutes
  validation:
    validate_inputs: true
    validate_outputs: true

# State-specific system prompt overrides
state_overrides:
  NSW:
    system_prompt_overrides:
      australian_legal: "fragments/state_requirements/NSW/ocr_terminology.md"
  
  VIC:
    system_prompt_overrides:
      australian_legal: "fragments/state_requirements/VIC/ocr_terminology.md"
  
  QLD:
    system_prompt_overrides:
      australian_legal: "fragments/state_requirements/QLD/risk_indicators.md"